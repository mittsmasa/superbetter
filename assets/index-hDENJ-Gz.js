import{c as S,l as I}from"./entity-history-item.stories-BXbYpon9.js";import"./iframe-8PfW34ZG.js";import"./preload-helper-PPVm8Dsz.js";import"./index-t8Ad9woq.js";import"./index-FFRRUK6N.js";import"./index-BbWNeX2n.js";import"drizzle-orm";import"./date-CyM_0PVW.js";import"drizzle-orm/mysql2";import"mysql2/promise";import"./index-C95F90gk.js";import"./proxy-DLSblRkh.js";import"./cx-BFURdk0p.js";import"./pixel-border-5a4dsT1Y.js";const P=(f,R)=>{let w=null;const j=S({config:{adapterId:"memory",adapterName:"Memory Adapter",usePlural:!1,debugLogs:R?.debugLogs||!1,supportsArrays:!0,customTransformInput(p){return(p.options.advanced?.database?.useNumberId||p.options.advanced?.database?.generateId==="serial")&&p.field==="id"&&p.action==="create"?f[p.model].length+1:p.data},transaction:async p=>{const M=structuredClone(f);try{return await p(j(w))}catch(A){throw Object.keys(f).forEach(v=>{f[v]=M[v]}),A}}},adapter:({getFieldName:p,options:M,getModelName:A})=>{const v=(e,n,c)=>n?e.sort((a,i)=>{const y=p({model:c,field:n.field}),u=a[y],t=i[y];let r=0;return u==null&&t==null?r=0:u==null?r=-1:t==null?r=1:typeof u=="string"&&typeof t=="string"?r=u.localeCompare(t):u instanceof Date&&t instanceof Date?r=u.getTime()-t.getTime():typeof u=="number"&&typeof t=="number"?r=u-t:typeof u=="boolean"&&typeof t=="boolean"?r=u===t?0:u?1:-1:r=String(u).localeCompare(String(t)),n.direction==="asc"?r:-r}):e;function h(e,n,c){const a=(t,r)=>{const g=f[r];if(!g)throw I.error(`[MemoryAdapter] Model ${r} not found in the DB`,Object.keys(f)),new Error(`Model ${r} not found`);const m=(o,d)=>{const{field:l,value:s,operator:b}=d;switch(b){case"in":if(!Array.isArray(s))throw new Error("Value must be an array");return s.includes(o[l]);case"not_in":if(!Array.isArray(s))throw new Error("Value must be an array");return!s.includes(o[l]);case"contains":return o[l].includes(s);case"starts_with":return o[l].startsWith(s);case"ends_with":return o[l].endsWith(s);case"ne":return o[l]!==s;case"gt":return s!=null&&o[l]>s;case"gte":return s!=null&&o[l]>=s;case"lt":return s!=null&&o[l]<s;case"lte":return s!=null&&o[l]<=s;default:return o[l]===s}};return g.filter(o=>{if(!t.length||t.length===0)return!0;let d=m(o,t[0]);for(const l of t){const s=m(o,l);l.connector==="OR"?d=d||s:d=d&&s}return d})};if(!c)return a(e,n);const i=a(e,n),y=new Map,u=new Map;for(const t of i){const r=String(t.id);if(!y.has(r)){const m={...t};for(const[o,d]of Object.entries(c)){const l=A(o);d.relation==="one-to-one"?m[l]=null:(m[l]=[],u.set(`${r}-${o}`,new Set))}y.set(r,m)}const g=y.get(r);for(const[m,o]of Object.entries(c)){const d=A(m),l=f[d];if(!l)throw I.error(`[MemoryAdapter] JoinOption model ${d} not found in the DB`,Object.keys(f)),new Error(`JoinOption model ${d} not found`);const s=l.filter(b=>b[o.on.to]===t[o.on.from]);if(o.relation==="one-to-one")g[d]=s[0]||null;else{const b=u.get(`${r}-${m}`),C=o.limit??100;let E=0;for(const O of s){if(E>=C)break;b.has(O.id)||(g[d].push(O),b.add(O.id),E++)}}}}return Array.from(y.values())}return{create:async({model:e,data:n})=>((M.advanced?.database?.useNumberId||M.advanced?.database?.generateId==="serial")&&(n.id=f[A(e)].length+1),f[e]||(f[e]=[]),f[e].push(n),n),findOne:async({model:e,where:n,join:c})=>{const a=h(n,e,c);if(c){const i=a;return i.length?i[0]:null}return a[0]||null},findMany:async({model:e,where:n,sortBy:c,limit:a,offset:i,join:y})=>{const u=h(n||[],e,y);if(y){const r=u;if(!r.length)return[];v(r,c,e);let g=r;return i!==void 0&&(g=g.slice(i)),a!==void 0&&(g=g.slice(0,a)),g}let t=v(u,c,e);return i!==void 0&&(t=t.slice(i)),a!==void 0&&(t=t.slice(0,a)),t||[]},count:async({model:e,where:n})=>n?h(n,e).length:f[e].length,update:async({model:e,where:n,update:c})=>{const a=h(n,e);return a.forEach(i=>{Object.assign(i,c)}),a[0]||null},delete:async({model:e,where:n})=>{const c=f[e],a=h(n,e);f[e]=c.filter(i=>!a.includes(i))},deleteMany:async({model:e,where:n})=>{const c=f[e],a=h(n,e);let i=0;return f[e]=c.filter(y=>a.includes(y)?(i++,!1):!a.includes(y)),i},updateMany({model:e,where:n,update:c}){const a=h(n,e);return a.forEach(i=>{Object.assign(i,c)}),a[0]||null}}}});return p=>(w=p,j(p))};export{P as memoryAdapter};
